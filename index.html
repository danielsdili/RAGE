<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Mlátička 2D</title>

  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: #111;
      touch-action: none;
      font-family: Arial, sans-serif;
    }

    canvas {
      display: block;
      background: #eee;
    }

    #controls {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      height: 160px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      box-sizing: border-box;
      background: rgba(0,0,0,0.65);
    }

    .left-controls, .right-controls {
      display: flex;
      gap: 15px;
    }

    .btn {
      width: 90px;
      height: 90px;
      border-radius: 20px;
      background: rgba(255,255,255,0.2);
      border: 2px solid rgba(255,255,255,0.5);
      color: white;
      font-size: 20px;
      font-weight: bold;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
    }

    .btn:active {
      background: rgba(255,255,255,0.55);
    }

    .big-btn {
      width: 120px;
      height: 120px;
      font-size: 22px;
    }
  </style>
</head>
<body>

<canvas id="gameCanvas"></canvas>

<div id="controls">
  <div class="left-controls">
    <div class="btn" id="leftBtn">⬅️</div>
    <div class="btn" id="rightBtn">➡️</div>
  </div>

  <div class="right-controls">
    <div class="btn big-btn" id="jumpBtn">JUMP</div>
    <div class="btn big-btn" id="attackBtn">HIT</div>
  </div>
</div>

<script>
  const canvas = document.getElementById("gameCanvas");
  const ctx = canvas.getContext("2d");

  function resizeCanvas() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  const controlsHeight = 160;
  let groundY = canvas.height - controlsHeight - 70;

  // Slowmotion efekt při zabití
  let slowMotionTimer = 0;

  const gravity = 1;
  const jumpStrength = -20;

  const input = {
    left: false,
    right: false,
    jump: false,
    attack: false
  };

  function setButtonEvents(button, keyName) {
    button.addEventListener("touchstart", (e) => {
      e.preventDefault();
      input[keyName] = true;
    });

    button.addEventListener("touchend", (e) => {
      e.preventDefault();
      input[keyName] = false;
    });

    button.addEventListener("touchcancel", (e) => {
      e.preventDefault();
      input[keyName] = false;
    });
  }

  setButtonEvents(document.getElementById("leftBtn"), "left");
  setButtonEvents(document.getElementById("rightBtn"), "right");
  setButtonEvents(document.getElementById("jumpBtn"), "jump");
  setButtonEvents(document.getElementById("attackBtn"), "attack");

  const player = {
    x: 150,
    y: groundY - 80,
    width: 55,
    height: 90,
    speed: 7,
    velocityY: 0,
    onGround: true,
    hp: 100,
    facing: 1, // 1 doprava, -1 doleva
    attackCooldown: 0
  };

  const enemies = [
    {
      x: 750,
      y: groundY - 80,
      width: 55,
      height: 90,
      hp: 60,
      speed: 2.5,
      alive: true,
      weapon: "knife",
      hitCooldown: 0
    }
  ];

  // Krevní částice (stylizované)
  const particles = [];

  function spawnBlood(x, y, amount = 40) {
    for (let i = 0; i < amount; i++) {
      particles.push({
        x: x,
        y: y,
        vx: (Math.random() - 0.5) * 12,
        vy: -Math.random() * 14,
        size: Math.random() * 6 + 2,
        life: 60 + Math.random() * 40
      });
    }
  }

  function rectsCollide(a, b) {
    return (
      a.x < b.x + b.width &&
      a.x + a.width > b.x &&
      a.y < b.y + b.height &&
      a.y + a.height > b.y
    );
  }

  function playerAttack() {
    if (player.attackCooldown > 0) return;

    player.attackCooldown = 25;

    // Hitbox baseballky před hráčem
    const batHitbox = {
      x: player.facing === 1 ? player.x + player.width : player.x - 60,
      y: player.y + 20,
      width: 60,
      height: 40
    };

    enemies.forEach(enemy => {
      if (!enemy.alive) return;

      if (rectsCollide(batHitbox, enemy)) {
        enemy.hp -= 25;

        // Knockback
        enemy.x += player.facing * 35;

        // Krevní prsknutí
        spawnBlood(enemy.x + enemy.width / 2, enemy.y + 30, 25);

        if (enemy.hp <= 0) {
          enemy.alive = false;

          // Mega gejzír
          spawnBlood(enemy.x + enemy.width / 2, enemy.y + 20, 120);

          // Slowmotion efekt
          slowMotionTimer = 60;
        }
      }
    });
  }

  function update() {
    groundY = canvas.height - controlsHeight - 70;

    let timeScale = slowMotionTimer > 0 ? 0.35 : 1;

    if (slowMotionTimer > 0) slowMotionTimer--;

    // Cooldowny
    if (player.attackCooldown > 0) player.attackCooldown -= 1 * timeScale;

    // Pohyb hráče
    if (input.left) {
      player.x -= player.speed * timeScale;
      player.facing = -1;
    }
    if (input.right) {
      player.x += player.speed * timeScale;
      player.facing = 1;
    }

    // Skok
    if (input.jump && player.onGround) {
      player.velocityY = jumpStrength;
      player.onGround = false;
    }

    // Útok
    if (input.attack) {
      playerAttack();
    }

    // Gravitace
    player.velocityY += gravity * timeScale;
    player.y += player.velocityY * timeScale;

    // Zem
    if (player.y + player.height >= groundY) {
      player.y = groundY - player.height;
      player.velocityY = 0;
      player.onGround = true;
    }

    // Okraje
    if (player.x < 0) player.x = 0;
    if (player.x + player.width > canvas.width) {
      player.x = canvas.width - player.width;
    }

    // Nepřítel AI (jde za tebou)
    enemies.forEach(enemy => {
      if (!enemy.alive) return;

      if (enemy.hitCooldown > 0) enemy.hitCooldown -= 1 * timeScale;

      if (enemy.x < player.x - 10) enemy.x += enemy.speed * timeScale;
      if (enemy.x > player.x + 10) enemy.x -= enemy.speed * timeScale;

      // Útok nepřítele když je blízko
      const dist = Math.abs(enemy.x - player.x);
      if (dist < 70 && enemy.hitCooldown <= 0) {
        player.hp -= 10;
        enemy.hitCooldown = 50;

        // Krev z hráče
        spawnBlood(player.x + player.width / 2, player.y + 40, 20);

        // Knockback hráče
        player.x += (enemy.x < player.x ? 30 : -30);
      }
    });

    // Particles update
    for (let i = particles.length - 1; i >= 0; i--) {
      const p = particles[i];
      p.vy += 0.6 * timeScale;
      p.x += p.vx * timeScale;
      p.y += p.vy * timeScale;
      p.life -= 1 * timeScale;

      // odraz od země
      if (p.y > groundY) {
        p.y = groundY;
        p.vy *= -0.3;
        p.vx *= 0.7;
      }

      if (p.life <= 0) particles.splice(i, 1);
    }
  }

  function drawHealthBar(x, y, w, h, hp, maxHp) {
    ctx.fillStyle = "black";
    ctx.fillRect(x, y, w, h);

    const fill = Math.max(0, (hp / maxHp) * w);

    ctx.fillStyle = "lime";
    ctx.fillRect(x, y, fill, h);
  }

  function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Pozadí
    ctx.fillStyle = "#d9d9d9";
    ctx.fillRect(0, 0, canvas.width, canvas.height);

    // Zem
    ctx.fillStyle = "green";
    ctx.fillRect(0, groundY, canvas.width, canvas.height - groundY);

    // Hráč
    ctx.fillStyle = "red";
    ctx.fillRect(player.x, player.y, player.width, player.height);

    // Baseballka
    ctx.strokeStyle = "brown";
    ctx.lineWidth = 8;

    let batX1 = player.x + player.width / 2;
    let batY1 = player.y + 40;
    let batX2 = batX1 + player.facing * 60;
    let batY2 = batY1 - 10;

    ctx.beginPath();
    ctx.moveTo(batX1, batY1);
    ctx.lineTo(batX2, batY2);
    ctx.stroke();

    // Nepřátelé
    enemies.forEach(enemy => {
      if (!enemy.alive) return;

      ctx.fillStyle = "black";
      ctx.fillRect(enemy.x, enemy.y, enemy.width, enemy.height);

      // Zbraň (nůž)
      ctx.strokeStyle = "silver";
      ctx.lineWidth = 6;

      ctx.beginPath();
      ctx.moveTo(enemy.x + enemy.width / 2, enemy.y + 40);
      ctx.lineTo(enemy.x + enemy.width / 2 - 35, enemy.y + 35);
      ctx.stroke();

      // HP bar nepřítele
      drawHealthBar(enemy.x, enemy.y - 18, 60, 10, enemy.hp, 60);
    });

    // Krev (částice)
    ctx.fillStyle = "darkred";
    particles.forEach(p => {
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
    });

    // HP hráče
    drawHealthBar(20, 20, 200, 18, player.hp, 100);

    // Slowmotion text
    if (slowMotionTimer > 0) {
      ctx.fillStyle = "rgba(0,0,0,0.5)";
      ctx.font = "50px Arial";
      ctx.fillText("SLOMO!", canvas.width / 2 - 100, 120);
    }

    // Debug info
    ctx.fillStyle = "black";
    ctx.font = "18px Arial";
    ctx.fillText("⚾ Baseballka | HIT = útok", 20, 60);
  }

  function gameLoop() {
    update();
    draw();
    requestAnimationFrame(gameLoop);
  }

  gameLoop();
</script>

</body>
</html>
