<!DOCTYPE html>
<html lang="cs">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>STREET RAGE</title>

  <style>
    body {
      margin: 0;
      background: radial-gradient(circle at top, #111, #000);
      font-family: Arial, sans-serif;
      overflow: hidden;
      color: white;
      touch-action: none;
    }

    #hud {
      width: 100%;
      max-width: 520px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      font-size: 14px;
      font-weight: bold;
      padding: 10px 14px;
      box-sizing: border-box;
      gap: 10px;
      align-items: center;
    }

    .barWrap {
      width: 160px;
      height: 14px;
      border: 2px solid gold;
      border-radius: 10px;
      overflow: hidden;
      background: rgba(0,0,0,0.6);
      box-shadow: 0 0 10px rgba(255,215,0,0.2);
    }

    .bar {
      height: 100%;
      width: 100%;
      background: linear-gradient(90deg, #ff4040, #ffcc00);
      transition: width 0.1s linear;
    }

    #score {
      font-size: 16px;
      color: gold;
      text-shadow: 0 0 10px rgba(255,215,0,0.35);
    }

    #wrap {
      width: 100%;
      max-width: 520px;
      margin: 0 auto;
      position: relative;
    }

    canvas {
      width: 100%;
      height: 75vh;
      border: 4px solid #444;
      border-radius: 14px;
      background: linear-gradient(#111, #050505);
      display: block;
      box-shadow: 0 0 20px rgba(255,255,255,0.08);
    }

    #controls {
      width: 100%;
      max-width: 520px;
      margin: 12px auto;
      display: flex;
      justify-content: space-between;
      gap: 10px;
      padding: 0 12px;
      box-sizing: border-box;
    }

    .btn {
      flex: 1;
      height: 80px;
      border-radius: 18px;
      color: black;
      font-size: 26px;
      font-weight: 900;
      display: flex;
      justify-content: center;
      align-items: center;
      user-select: none;
      -webkit-user-select: none;
      -webkit-touch-callout: none;
      background: repeating-linear-gradient(
        45deg,
        #ffd500,
        #ffd500 12px,
        #111 12px,
        #111 24px
      );
      border: 3px solid #ffd500;
      box-shadow: 0 0 14px rgba(255,213,0,0.25);
      text-shadow: 0 0 6px rgba(0,0,0,0.8);
    }

    .btn:active {
      transform: scale(0.96);
      filter: brightness(1.2);
    }

    .attackBtn {
      flex: 1.4;
      font-size: 22px;
      letter-spacing: 2px;
    }

    /* START SCREEN */
    #startScreen {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.95);
      display: flex;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      z-index: 999;
      border-radius: 14px;
    }

    #introText {
      font-size: 15px;
      font-weight: 900;
      letter-spacing: 3px;
      color: #ffd500;
      opacity: 0.9;
    }

    #mainLogo {
      font-size: 56px;
      margin: 14px 0 0 0;
      color: gold;
      letter-spacing: 6px;
      text-shadow: 0 0 25px rgba(255,215,0,0.35);
    }

    #subText {
      margin-top: 12px;
      font-size: 14px;
      opacity: 0.8;
    }

    #startBtn {
      margin-top: 26px;
      padding: 16px 32px;
      border: none;
      border-radius: 14px;
      font-size: 20px;
      cursor: pointer;
      background: repeating-linear-gradient(
        45deg,
        #ffd500,
        #ffd500 12px,
        #111 12px,
        #111 24px
      );
      color: black;
      font-weight: 900;
      box-shadow: 0 0 20px rgba(255,215,0,0.25);
    }

    /* GAME OVER */
    #gameOver {
      position: absolute;
      inset: 0;
      background: rgba(0,0,0,0.88);
      display: none;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      z-index: 999;
      border-radius: 14px;
    }

    #gameOver h1 {
      margin: 0;
      font-size: 42px;
      color: gold;
      text-shadow: 0 0 15px rgba(255,215,0,0.3);
    }

    #gameOver p {
      margin: 12px 0;
      opacity: 0.9;
    }

    button {
      padding: 12px 18px;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      cursor: pointer;
      background: gold;
      font-weight: bold;
      box-shadow: 0 0 10px rgba(255,215,0,0.3);
    }
  </style>
</head>

<body>

<div id="hud">
  <div>
    <div style="font-size:12px; opacity:0.85;">HP</div>
    <div class="barWrap"><div id="hpBar" class="bar"></div></div>
  </div>

  <div id="score">Score: 0</div>

  <div>
    <div style="font-size:12px; opacity:0.85;">ENEMY</div>
    <div class="barWrap"><div id="enemyBar" class="bar"></div></div>
  </div>
</div>

<div id="wrap">
  <canvas id="game"></canvas>

  <div id="startScreen">
    <div id="introText">DANIEL_SDILI UVÁDÍ:</div>
    <div id="mainLogo">STREET RAGE</div>
    <div id="subText">Beat'em Up - Canvas Edition</div>
    <button id="startBtn">START</button>
  </div>

  <div id="gameOver">
    <h1>YOU GOT KO!</h1>
    <p>Score: <span id="finalScore">0</span></p>
    <button onclick="restartGame()">Restart</button>
  </div>
</div>

<div id="controls">
  <div class="btn" id="leftBtn">◀</div>
  <div class="btn" id="jumpBtn">JUMP</div>
  <div class="btn attackBtn" id="attackBtn">PUNCH</div>
  <div class="btn" id="rightBtn">▶</div>
</div>

<script>
  const canvas = document.getElementById("game");
  const ctx = canvas.getContext("2d");

  const hpBar = document.getElementById("hpBar");
  const enemyBar = document.getElementById("enemyBar");
  const scoreEl = document.getElementById("score");

  const startScreen = document.getElementById("startScreen");
  const startBtn = document.getElementById("startBtn");

  const gameOverScreen = document.getElementById("gameOver");
  const finalScoreEl = document.getElementById("finalScore");

  const leftBtn = document.getElementById("leftBtn");
  const rightBtn = document.getElementById("rightBtn");
  const jumpBtn = document.getElementById("jumpBtn");
  const attackBtn = document.getElementById("attackBtn");

  let w, h;

  function resizeCanvas() {
    const rect = canvas.getBoundingClientRect();
    canvas.width = rect.width * devicePixelRatio;
    canvas.height = rect.height * devicePixelRatio;
    ctx.setTransform(devicePixelRatio, 0, 0, devicePixelRatio, 0, 0);
    w = rect.width;
    h = rect.height;
  }

  window.addEventListener("resize", resizeCanvas);
  resizeCanvas();

  function rand(min, max) {
    return Math.random() * (max - min) + min;
  }

  let running = false;
  let frame = 0;
  let score = 0;

  // CAMERA
  let camX = 0;

  // PLAYER
  const player = {
    x: 180,
    y: 0,
    w: 55,
    h: 100,
    vx: 0,
    vy: 0,
    speed: 4.6,
    hp: 100,
    maxHp: 100,
    onGround: true,
    attackCooldown: 0,
    facing: 1,
    hitFlash: 0
  };

  // ENEMY
  const enemy = {
    x: 350,
    y: 0,
    w: 55,
    h: 100,
    vx: 0,
    vy: 0,
    hp: 100,
    maxHp: 100,
    onGround: true,
    attackCooldown: 0,
    facing: -1,
    hitFlash: 0
  };

  const groundY = () => h - 80;

  // FX
  let hitSparks = [];
  let dust = [];

  function spawnHit(x, y) {
    for (let i = 0; i < 25; i++) {
      hitSparks.push({
        x, y,
        vx: rand(-8, 8),
        vy: rand(-8, 8),
        life: rand(14, 28),
        size: rand(2, 6)
      });
    }
  }

  function spawnDust(x, y) {
    for (let i = 0; i < 4; i++) {
      dust.push({
        x: x + rand(-8, 8),
        y: y + rand(-2, 2),
        vx: rand(-1.2, 1.2),
        vy: rand(-1.2, -2.2),
        life: rand(30, 55),
        size: rand(8, 18)
      });
    }
  }

  function updateFX() {
    hitSparks.forEach((p, i) => {
      p.life--;
      p.x += p.vx;
      p.y += p.vy;
      p.vx *= 0.92;
      p.vy *= 0.92;
      if (p.life <= 0) hitSparks.splice(i, 1);
    });

    dust.forEach((d, i) => {
      d.life--;
      d.x += d.vx;
      d.y += d.vy;
      d.size += 0.25;
      if (d.life <= 0) dust.splice(i, 1);
    });
  }

  function drawFX() {
    dust.forEach(d => {
      ctx.globalAlpha = (d.life / 55) * 0.35;
      ctx.fillStyle = "rgba(200,180,120,1)";
      ctx.beginPath();
      ctx.arc(d.x - camX, d.y, d.size, 0, Math.PI * 2);
      ctx.fill();
      ctx.globalAlpha = 1;
    });

    hitSparks.forEach(p => {
      ctx.globalAlpha = (p.life / 28);
      ctx.fillStyle = "gold";
      ctx.beginPath();
      ctx.arc(p.x - camX, p.y, p.size, 0, Math.PI * 2);
      ctx.fill();
      ctx.globalAlpha = 1;
    });
  }

  // INPUT
  let holdingLeft = false;
  let holdingRight = false;

  function bindButton(btn, onDown, onUp) {
    btn.addEventListener("touchstart", (e) => { e.preventDefault(); onDown(); });
    btn.addEventListener("touchend", (e) => { e.preventDefault(); onUp(); });
    btn.addEventListener("mousedown", (e) => { e.preventDefault(); onDown(); });
    btn.addEventListener("mouseup", (e) => { e.preventDefault(); onUp(); });
    btn.addEventListener("mouseleave", (e) => { e.preventDefault(); onUp(); });
  }

  bindButton(leftBtn, () => holdingLeft = true, () => holdingLeft = false);
  bindButton(rightBtn, () => holdingRight = true, () => holdingRight = false);

  bindButton(jumpBtn, () => {
    if (!running) return;
    if (player.onGround) {
      player.vy = -13;
      player.onGround = false;
      spawnDust(player.x + player.w/2, player.y + player.h);
    }
  }, () => {});

  bindButton(attackBtn, () => {
    if (!running) return;
    if (player.attackCooldown <= 0) {
      player.attackCooldown = 25;
      punch();
    }
  }, () => {});

  function punch() {
    const reach = 55;
    const px = player.x + player.w/2 + player.facing * reach;
    const py = player.y + 50;

    // hitbox enemy
    const ex = enemy.x + enemy.w/2;
    const ey = enemy.y + 50;

    const dist = Math.abs(px - ex) + Math.abs(py - ey);

    if (dist < 70 && enemy.hp > 0) {
      enemy.hp -= 14;
      enemy.hitFlash = 8;
      score += 100;

      spawnHit(ex, ey);
      enemy.vx += player.facing * 4.5;

      if (enemy.hp <= 0) {
        enemy.hp = 0;
        score += 500;
      }
    } else {
      // whiff dust
      spawnDust(px, py);
    }
  }

  function enemyAI() {
    if (enemy.hp <= 0) return;

    const dist = (player.x - enemy.x);

    if (Math.abs(dist) > 65) {
      enemy.vx += Math.sign(dist) * 0.35;
      enemy.facing = Math.sign(dist);
    } else {
      // enemy attacks
      if (enemy.attackCooldown <= 0) {
        enemy.attackCooldown = 50;
        enemyPunch();
      }
    }
  }

  function enemyPunch() {
    const reach = 50;
    const ex = enemy.x + enemy.w/2 + enemy.facing * reach;
    const ey = enemy.y + 50;

    const px = player.x + player.w/2;
    const py = player.y + 50;

    const dist = Math.abs(ex - px) + Math.abs(ey - py);

    if (dist < 75 && player.hp > 0) {
      player.hp -= 10;
      player.hitFlash = 8;
      spawnHit(px, py);
      player.vx += enemy.facing * 4.2;

      if (player.hp <= 0) {
        player.hp = 0;
        endGame();
      }
    }
  }

  function updatePhysics(ent) {
    ent.vy += 0.6; // gravity
    ent.x += ent.vx;
    ent.y += ent.vy;

    ent.vx *= 0.85;

    if (ent.y + ent.h >= groundY()) {
      ent.y = groundY() - ent.h;
      ent.vy = 0;
      ent.onGround = true;
    }

    // boundaries
    if (ent.x < 0) ent.x = 0;
    if (ent.x > 2000) ent.x = 2000; // world width
  }

  function updatePlayer() {
    if (!running) return;

    if (holdingLeft) {
      player.vx = -player.speed;
      player.facing = -1;
      if (frame % 4 === 0) spawnDust(player.x + player.w/2, player.y + player.h);
    }

    if (holdingRight) {
      player.vx = player.speed;
      player.facing = 1;
      if (frame % 4 === 0) spawnDust(player.x + player.w/2, player.y + player.h);
    }

    if (player.attackCooldown > 0) player.attackCooldown--;
    if (player.hitFlash > 0) player.hitFlash--;

    updatePhysics(player);
  }

  function updateEnemy() {
    if (!running) return;

    enemyAI();

    if (enemy.attackCooldown > 0) enemy.attackCooldown--;
    if (enemy.hitFlash > 0) enemy.hitFlash--;

    updatePhysics(enemy);
  }

  function updateHUD() {
    hpBar.style.width = (player.hp / player.maxHp * 100) + "%";
    enemyBar.style.width = (enemy.hp / enemy.maxHp * 100) + "%";
    scoreEl.textContent = "Score: " + score;
  }

  function updateCamera() {
    camX = player.x - w/2 + player.w/2;
    camX = Math.max(0, Math.min(camX, 2000 - w));
  }

  // DRAW
  function drawBackground() {
    // sky
    const g = ctx.createLinearGradient(0, 0, 0, h);
    g.addColorStop(0, "#0a0a12");
    g.addColorStop(0.5, "#050508");
    g.addColorStop(1, "#000000");

    ctx.fillStyle = g;
    ctx.fillRect(0, 0, w, h);

    // distant buildings
    ctx.globalAlpha = 0.35;
    for (let i = 0; i < 25; i++) {
      const bx = (i * 120 - (camX * 0.3)) % (w + 200) - 200;
      const bh = 120 + (i % 6) * 35;
      ctx.fillStyle = "rgba(40,40,60,1)";
      ctx.fillRect(bx, h - 240 - bh, 90, bh);

      // windows
      ctx.globalAlpha = 0.25;
      ctx.fillStyle = "rgba(255,200,80,1)";
      for (let j = 0; j < 8; j++) {
        ctx.fillRect(bx + 10 + (j%3)*22, h - 240 - bh + 15 + Math.floor(j/3)*22, 10, 12);
      }
      ctx.globalAlpha = 0.35;
    }
    ctx.globalAlpha = 1;

    // street ground
    ctx.fillStyle = "#050505";
    ctx.fillRect(0, groundY(), w, h - groundY());

    // street texture stripes
    ctx.globalAlpha = 0.15;
    ctx.fillStyle = "white";
    for (let i = 0; i < 15; i++) {
      ctx.fillRect((i * 90 - camX * 0.8) % (w + 90), groundY() + 18, 45, 4);
    }
    ctx.globalAlpha = 1;

    // neon curb
    ctx.globalAlpha = 0.35;
    ctx.fillStyle = "rgba(255,215,0,1)";
    ctx.fillRect(0, groundY(), w, 6);
    ctx.globalAlpha = 1;
  }

  function drawCharacter(ent, bodyColor, glowColor) {
    ctx.save();
    ctx.translate(ent.x - camX + ent.w/2, ent.y + ent.h/2);

    // shadow
    ctx.globalAlpha = 0.35;
    ctx.fillStyle = "black";
    ctx.beginPath();
    ctx.ellipse(0, ent.h/2 - 5, ent.w * 0.7, 14, 0, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;

    // glow
    ctx.globalAlpha = 0.18;
    ctx.fillStyle = glowColor;
    ctx.beginPath();
    ctx.arc(0, 0, 65, 0, Math.PI * 2);
    ctx.fill();
    ctx.globalAlpha = 1;

    // body
    ctx.fillStyle = bodyColor;
    ctx.fillRect(-ent.w/2, -ent.h/2, ent.w, ent.h);

    // head
    ctx.fillStyle = "rgba(220,200,160,1)";
    ctx.fillRect(-18, -ent.h/2 - 20, 36, 30);

    // eyes
    ctx.fillStyle = "black";
    ctx.fillRect(-10, -ent.h/2 - 10, 6, 6);
    ctx.fillRect(4, -ent.h/2 - 10, 6, 6);

    // arms
    ctx.fillStyle = "rgba(180,150,120,1)";
    ctx.fillRect(-ent.w/2 - 10, -ent.h/2 + 20, 10, 40);
    ctx.fillRect(ent.w/2, -ent.h/2 + 20, 10, 40);

    // legs
    ctx.fillStyle = "rgba(30,30,30,1)";
    ctx.fillRect(-ent.w/2 + 8, ent.h/2 - 30, 14, 30);
    ctx.fillRect(ent.w/2 - 22, ent.h/2 - 30, 14, 30);

    // hit flash
    if (ent.hitFlash > 0) {
      ctx.globalAlpha = 0.4;
      ctx.fillStyle = "white";
      ctx.fillRect(-ent.w/2, -ent.h/2, ent.w, ent.h);
      ctx.globalAlpha = 1;
    }

    ctx.restore();
  }

  function drawEnemyKO() {
    if (enemy.hp > 0) return;

    ctx.save();
    ctx.globalAlpha = 0.8;
    ctx.fillStyle = "gold";
    ctx.font = "bold 38px Arial";
    ctx.textAlign = "center";
    ctx.fillText("ENEMY KO!", w/2, h/2 - 40);
    ctx.restore();
  }

  function draw() {
    drawBackground();
    drawFX();

    drawCharacter(player, "#ff2b2b", "rgba(255,50,50,1)");
    drawCharacter(enemy, "#2bd4ff", "rgba(0,200,255,1)");

    drawEnemyKO();
  }

  function endGame() {
    running = false;
    finalScoreEl.textContent = score;
    gameOverScreen.style.display = "flex";
  }

  function restartGame() {
    score = 0;
    frame = 0;
    running = true;

    player.x = 180;
    player.y = groundY() - player.h;
    player.vx = 0;
    player.vy = 0;
    player.hp = 100;

    enemy.x = 420;
    enemy.y = groundY() - enemy.h;
    enemy.vx = 0;
    enemy.vy = 0;
    enemy.hp = 100;

    camX = 0;
    hitSparks = [];
    dust = [];

    gameOverScreen.style.display = "none";
  }

  window.restartGame = restartGame;

  function loop() {
    frame++;

    if (running) {
      updatePlayer();
      updateEnemy();
      updateFX();
      updateCamera();
      updateHUD();
    }

    draw();
    requestAnimationFrame(loop);
  }

  startBtn.addEventListener("click", () => {
    startScreen.style.display = "none";
    running = true;

    player.y = groundY() - player.h;
    enemy.y = groundY() - enemy.h;

    requestAnimationFrame(loop);
  });

</script>

</body>
</html>
